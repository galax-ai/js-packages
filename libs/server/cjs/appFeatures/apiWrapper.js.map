{"version":3,"sources":["../../lib/appFeatures/apiWrapper.js"],"sourcesContent":["import { Feature } from \"@galaxar/app\";\nimport http from \"node:http\";\n\nconst statusToError = {\n    400: 'invalid_request',\n    401: 'unauthenticated',\n    403: 'permission_denied',\n    404: 'resource_not_found',\n};\n\nconst unknownError = 'unknown_error';\n\nexport default {\n\n    /**\n     * This feature is loaded at init stage\n     * @member {string}\n     */\n    stage: Feature.SERVICE,\n\n    /**\n     * Load the feature\n     * @param {App} app - The cli app module object\n     * @param {object} settings - Settings of soal client   \n     * @returns {Promise.<*>}\n     */\n    load_: async function (app, settings, name) {\n        const service = {\n            wrapResult: (ctx, result = null, others) => {\n                return {\n                    status: 'success',\n                    ...others,\n                    result,\n                };\n            },\n        \n            wrapError: (ctx, error, others) => {\n                const code = error.code || statusToError[ctx.status] || unknownError;\n                                \n                return {\n                    status: 'error',\n                    ...others,                    \n                    error: {\n                        code,\n                        message: error.expose\n                            ? error.message\n                            : http.STATUS_CODES[ctx.status],\n                        ...(error.info ? { info: error.info }: null)\n                    },\n                };\n            },\n        };\n\n        app.registerService(name, service);\n    }\n};"],"names":["statusToError","unknownError","stage","Feature","SERVICE","load_","app","settings","name","service","wrapResult","ctx","result","others","status","wrapError","error","code","message","expose","http","STATUS_CODES","info","registerService"],"mappings":"oGAYA,iDAAA,+BAZwB,iEACP,kGAEjB,MAAMA,cAAgB,CAClB,IAAK,kBACL,IAAK,kBACL,IAAK,oBACL,IAAK,oBACT,EAEA,MAAMC,aAAe,sBAErB,SAAe,CAMXC,MAAOC,YAAO,CAACC,OAAO,CAQtBC,MAAO,eAAgBC,GAAG,CAAEC,QAAQ,CAAEC,IAAI,CAAE,CACxC,MAAMC,QAAU,CACZC,WAAY,CAACC,IAAKC,OAAS,IAAI,CAAEC,SAAW,CACxC,MAAO,CACHC,OAAQ,UACR,GAAGD,MAAM,CACTD,MACJ,CACJ,EAEAG,UAAW,CAACJ,IAAKK,MAAOH,SAAW,CAC/B,MAAMI,KAAOD,MAAMC,IAAI,EAAIjB,aAAa,CAACW,IAAIG,MAAM,CAAC,EAAIb,aAExD,MAAO,CACHa,OAAQ,QACR,GAAGD,MAAM,CACTG,MAAO,CACHC,KACAC,QAASF,MAAMG,MAAM,CACfH,MAAME,OAAO,CACbE,iBAAI,CAACC,YAAY,CAACV,IAAIG,MAAM,CAAC,CACnC,GAAIE,MAAMM,IAAI,CAAG,CAAEA,KAAMN,MAAMM,IAAI,AAAC,EAAG,IAAI,AAC/C,CACJ,CACJ,CACJ,EAEAhB,IAAIiB,eAAe,CAACf,KAAMC,QAC9B,CACJ"}
{"version":3,"sources":["../../lib/appFeatures/apiWrapper.js"],"sourcesContent":["const { Feature, Helpers: { ensureFeatureName } } = require('@genx/app');\nconst http = require('http');\n\nconst statusToError = {\n    400: 'invalid_request',\n    401: 'unauthenticated',\n    403: 'permission_denied',\n    404: 'resource_not_found',\n};\n\nconst unknownError = 'unknown_error';\n\nmodule.exports = {\n\n    /**\n     * This feature is loaded at init stage\n     * @member {string}\n     */\n    type: Feature.SERVICE,\n\n    /**\n     * This feature can be grouped by serviceGroup\n     * @member {boolean}\n     */\n    groupable: true,\n\n    /**\n     * Load the feature\n     * @param {App} app - The cli app module object\n     * @param {object} settings - Settings of soal client   \n     * @returns {Promise.<*>}\n     */\n    load_: async function (app, settings, name) {\n        ensureFeatureName(name);\n\n        const service = {\n            wrapResult: (ctx, result = null, others) => {\n                return {\n                    status: 'success',\n                    ...others,\n                    result,\n                };\n            },\n        \n            wrapError: (ctx, error, others) => {\n                const code = error.code || statusToError[ctx.status] || unknownError;\n                                \n                return {\n                    status: 'error',\n                    ...others,                    \n                    error: {\n                        code,\n                        message: error.expose\n                            ? error.message\n                            : http.STATUS_CODES[ctx.status],\n                        ...(error.info ? { info: error.info }: null)\n                    },\n                };\n            },\n        };\n\n        app.registerService(name, service);\n    }\n};"],"names":["Feature","Helpers","ensureFeatureName","require","http","statusToError","unknownError","module","exports","type","SERVICE","groupable","load_","app","settings","name","service","wrapResult","ctx","result","others","status","wrapError","error","code","message","expose","STATUS_CODES","info","registerService"],"mappings":"aAAA,KAAM,CAAEA,OAAO,CAAEC,QAAS,CAAEC,iBAAiB,CAAE,CAAE,CAAGC,QAAQ,aAC5D,MAAMC,KAAOD,QAAQ,QAErB,MAAME,cAAgB,CAClB,IAAK,kBACL,IAAK,kBACL,IAAK,oBACL,IAAK,oBACT,EAEA,MAAMC,aAAe,eAErBC,CAAAA,OAAOC,OAAO,CAAG,CAMbC,KAAMT,QAAQU,OAAO,CAMrBC,UAAW,IAAI,CAQfC,MAAO,eAAgBC,GAAG,CAAEC,QAAQ,CAAEC,IAAI,CAAE,CACxCb,kBAAkBa,MAElB,MAAMC,QAAU,CACZC,WAAY,CAACC,IAAKC,OAAS,IAAI,CAAEC,SAAW,CACxC,MAAO,CACHC,OAAQ,UACR,GAAGD,MAAM,CACTD,MACJ,CACJ,EAEAG,UAAW,CAACJ,IAAKK,MAAOH,SAAW,CAC/B,MAAMI,KAAOD,MAAMC,IAAI,EAAInB,aAAa,CAACa,IAAIG,MAAM,CAAC,EAAIf,aAExD,MAAO,CACHe,OAAQ,QACR,GAAGD,MAAM,CACTG,MAAO,CACHC,KACAC,QAASF,MAAMG,MAAM,CACfH,MAAME,OAAO,CACbrB,KAAKuB,YAAY,CAACT,IAAIG,MAAM,CAAC,CACnC,GAAIE,MAAMK,IAAI,CAAG,CAAEA,KAAML,MAAMK,IAAI,AAAC,EAAG,IAAI,AAC/C,CACJ,CACJ,CACJ,EAEAf,IAAIgB,eAAe,CAACd,KAAMC,QAC9B,CACJ"}
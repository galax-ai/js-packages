{"version":3,"sources":["../../lib/appFeatures/routing.js"],"sourcesContent":["/**\n * Enable web request routing.\n * @module Feature_Routing\n */\n\nimport { Feature } from '@galaxar/app';\nimport { _, batchAsync_, isPlainObject, esmCheck } from '@galaxar/utils';\n\nexport default {\n    /**\n     * This feature is loaded at ready (final) stage.\n     * @member {string}\n     */\n    stage: Feature.PLUGIN,\n\n    /**\n     * Load the feature.\n     * @param {Routable} app - The app module object\n     * @param {object} routes - Routes and configuration\n     * @returns {Promise.<*>}\n     */\n    load_: (app, routes) => {\n        app.on('after:' + Feature.PLUGIN, () =>\n            batchAsync_(routes, async (routersConfig, route) => {\n                if (isPlainObject(routersConfig)) {\n                    return batchAsync_(routersConfig, async (options, type) => {\n                        let loader_ = esmCheck(require('../routers/' + type));\n\n                        app.log('verbose', `A \"${type}\" router is created at \"${route}\" in app [${app.name}].`);\n\n                        return loader_(app, route, options);\n                    });\n                } else {\n                    // 'route': 'method:/path'\n                    let mainRoute = '/',\n                        baseRoute = route;\n                    let pos = route.indexOf(':/');\n\n                    if (pos !== -1) {\n                        mainRoute = route.substring(0, pos + 2);\n                        baseRoute = route.substring(pos + 1);\n                    } else if (Array.isArray(routersConfig)) {\n                        //all handled by middleware chains\n                        mainRoute = 'all:/';\n                    }\n\n                    let rules = {\n                        [mainRoute]: routersConfig,\n                    };\n\n                    const loader_ = esmCheck(require('../routers/rule'));\n                    app.log('verbose', `A \"rule\" router is created at \"${baseRoute}\" in app [${app.name}].`);\n\n                    return loader_(app, baseRoute, { rules: rules });\n                }\n            })\n        );\n    },\n};\n"],"names":["stage","Feature","PLUGIN","load_","app","routes","on","batchAsync_","routersConfig","route","isPlainObject","options","type","loader_","esmCheck","require","log","name","mainRoute","baseRoute","pos","indexOf","substring","Array","isArray","rules"],"mappings":"oGAQA,iDAAA,+BAHwB,qCACgC,wBAExD,SAAe,CAKXA,MAAOC,YAAO,CAACC,MAAM,CAQrBC,MAAO,CAACC,IAAKC,SAAW,CACpBD,IAAIE,EAAE,CAAC,SAAWL,YAAO,CAACC,MAAM,CAAE,IAC9BK,GAAAA,kBAAW,EAACF,OAAQ,MAAOG,cAAeC,QAAU,CAChD,GAAIC,GAAAA,oBAAa,EAACF,eAAgB,CAC9B,MAAOD,GAAAA,kBAAW,EAACC,cAAe,MAAOG,QAASC,OAAS,CACvD,IAAIC,QAAUC,GAAAA,eAAQ,EAACC,QAAQ,cAAgBH,OAE/CR,IAAIY,GAAG,CAAC,UAAW,CAAC,GAAG,EAAEJ,KAAK,wBAAwB,EAAEH,MAAM,UAAU,EAAEL,IAAIa,IAAI,CAAC,EAAE,CAAC,EAEtF,OAAOJ,QAAQT,IAAKK,MAAOE,QAC/B,EACJ,KAAO,CAEH,IAAIO,UAAY,IACZC,UAAYV,MAChB,IAAIW,IAAMX,MAAMY,OAAO,CAAC,MAExB,GAAID,MAAQ,CAAC,EAAG,CACZF,UAAYT,MAAMa,SAAS,CAAC,EAAGF,IAAM,GACrCD,UAAYV,MAAMa,SAAS,CAACF,IAAM,EACtC,MAAO,GAAIG,MAAMC,OAAO,CAAChB,eAAgB,CAErCU,UAAY,OAChB,CAAC,AAED,IAAIO,MAAQ,CACR,CAACP,UAAU,CAAEV,aACjB,EAEA,MAAMK,QAAUC,GAAAA,eAAQ,EAACC,QAAQ,oBACjCX,IAAIY,GAAG,CAAC,UAAW,CAAC,+BAA+B,EAAEG,UAAU,UAAU,EAAEf,IAAIa,IAAI,CAAC,EAAE,CAAC,EAEvF,OAAOJ,QAAQT,IAAKe,UAAW,CAAEM,MAAOA,KAAM,EAClD,CAAC,AACL,GAER,CACJ"}
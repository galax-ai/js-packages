{"version":3,"sources":["../../lib/helpers/httpMethod.js"],"sourcesContent":["import { _, isPlainObject, ensureStartsWith } from \"@galaxar/utils\";\nimport { ApplicationError } from '@galaxar/types';\n\n/**\n * Decorator for http method\n * @param {*} method\n * @param {*} middlewares\n * @returns\n */\nfunction httpMethod(method, middlewares) {\n    if (arguments.length === 3) {\n        return httpMethod('get')(...Array.prototype.slice.call(arguments));\n    }\n\n    return function (target, name, descriptor) {\n        let targetFunction,\n            isHof = false;\n\n        if (arguments.length === 1 && typeof target === 'function') {\n            targetFunction = target;\n            isHof = true;\n        } else if (arguments.length === 1 && target.kind === 'method') {\n            targetFunction = target.descriptor.value;\n            target.descriptor.enumerable = true;\n        } else if (descriptor && descriptor.value) {\n            targetFunction = descriptor.value;\n            descriptor.enumerable = true;\n        } else {\n            throw new ApplicationError('Invalid usage of httpMethod decorator.');\n        }\n\n        if (targetFunction) {\n            if (typeof method === 'string') {\n                let pos = method.indexOf(':/');\n\n                if (pos !== -1) {\n                    if (pos === 0) {\n                        throw new Error('Invalid httpMethod decorator param: ' + method);\n                    }\n\n                    // like get:/, or post:/\n\n                    //override actionName as route\n                    targetFunction.__metaRoute = method.substring(pos + 1);\n                    method = method.substring(0, pos).toLocaleLowerCase();\n                }\n            } else {\n                method = 'get';\n            }\n\n            targetFunction.__metaHttpMethod = method;\n\n            if (middlewares) {\n                if (isPlainObject(middlewares)) {\n                    targetFunction.__metaMiddlewares = _.map(middlewares, (options, name) => ({ name, options }));\n                } else {\n                    targetFunction.__metaMiddlewares = _.castArray(middlewares);\n                }\n            }\n        }\n\n        return isHof ? targetFunction : descriptor;\n    };\n}\n\nconst makeShortcut = (method) => (route, middlewares) => httpMethod(route ? `${method}:${ensureStartsWith(route, '/')}` : method, middlewares);\n\n// nestjs like decorators\nexport const Get = makeShortcut('get');\nexport const Post = makeShortcut('post');\nexport const Put = makeShortcut('put');\nexport const Delete = makeShortcut('del');\n\nexport default httpMethod;\n"],"names":["Get","Post","Put","Delete","httpMethod","method","middlewares","arguments","length","Array","prototype","slice","call","target","name","descriptor","targetFunction","isHof","kind","value","enumerable","ApplicationError","pos","indexOf","Error","__metaRoute","substring","toLocaleLowerCase","__metaHttpMethod","isPlainObject","__metaMiddlewares","_","map","options","castArray","makeShortcut","route","ensureStartsWith"],"mappings":";;;;;;;;;;;IAoEaA,GAAG;eAAHA;;IACAC,IAAI;eAAJA;;IACAC,GAAG;eAAHA;;IACAC,MAAM;eAANA;;IAEb,OAA0B;eAA1B;;;uBAzEmD;uBAClB;AAEjC;;;;;CAKC,GACD,SAASC,WAAWC,MAAM,EAAEC,WAAW,EAAE;IACrC,IAAIC,UAAUC,MAAM,KAAK,GAAG;QACxB,OAAOJ,WAAW,UAAUK,MAAMC,SAAS,CAACC,KAAK,CAACC,IAAI,CAACL;IAC3D,CAAC;IAED,OAAO,SAAUM,MAAM,EAAEC,IAAI,EAAEC,UAAU,EAAE;QACvC,IAAIC,gBACAC,QAAQ,KAAK;QAEjB,IAAIV,UAAUC,MAAM,KAAK,KAAK,OAAOK,WAAW,YAAY;YACxDG,iBAAiBH;YACjBI,QAAQ,IAAI;QAChB,OAAO,IAAIV,UAAUC,MAAM,KAAK,KAAKK,OAAOK,IAAI,KAAK,UAAU;YAC3DF,iBAAiBH,OAAOE,UAAU,CAACI,KAAK;YACxCN,OAAOE,UAAU,CAACK,UAAU,GAAG,IAAI;QACvC,OAAO,IAAIL,cAAcA,WAAWI,KAAK,EAAE;YACvCH,iBAAiBD,WAAWI,KAAK;YACjCJ,WAAWK,UAAU,GAAG,IAAI;QAChC,OAAO;YACH,MAAM,IAAIC,uBAAgB,CAAC,0CAA0C;QACzE,CAAC;QAED,IAAIL,gBAAgB;YAChB,IAAI,OAAOX,WAAW,UAAU;gBAC5B,IAAIiB,MAAMjB,OAAOkB,OAAO,CAAC;gBAEzB,IAAID,QAAQ,CAAC,GAAG;oBACZ,IAAIA,QAAQ,GAAG;wBACX,MAAM,IAAIE,MAAM,yCAAyCnB,QAAQ;oBACrE,CAAC;oBAED,wBAAwB;oBAExB,8BAA8B;oBAC9BW,eAAeS,WAAW,GAAGpB,OAAOqB,SAAS,CAACJ,MAAM;oBACpDjB,SAASA,OAAOqB,SAAS,CAAC,GAAGJ,KAAKK,iBAAiB;gBACvD,CAAC;YACL,OAAO;gBACHtB,SAAS;YACb,CAAC;YAEDW,eAAeY,gBAAgB,GAAGvB;YAElC,IAAIC,aAAa;gBACb,IAAIuB,IAAAA,oBAAa,EAACvB,cAAc;oBAC5BU,eAAec,iBAAiB,GAAGC,QAAC,CAACC,GAAG,CAAC1B,aAAa,CAAC2B,SAASnB,OAAU,CAAA;4BAAEA;4BAAMmB;wBAAQ,CAAA;gBAC9F,OAAO;oBACHjB,eAAec,iBAAiB,GAAGC,QAAC,CAACG,SAAS,CAAC5B;gBACnD,CAAC;YACL,CAAC;QACL,CAAC;QAED,OAAOW,QAAQD,iBAAiBD,UAAU;IAC9C;AACJ;AAEA,MAAMoB,eAAe,CAAC9B,SAAW,CAAC+B,OAAO9B,cAAgBF,WAAWgC,QAAQ,CAAC,EAAE/B,OAAO,CAAC,EAAEgC,IAAAA,uBAAgB,EAACD,OAAO,KAAK,CAAC,GAAG/B,MAAM,EAAEC;AAG3H,MAAMN,MAAMmC,aAAa;AACzB,MAAMlC,OAAOkC,aAAa;AAC1B,MAAMjC,MAAMiC,aAAa;AACzB,MAAMhC,SAASgC,aAAa;MAEnC,WAAe/B"}
{"version":3,"sources":["../../lib/middlewares/ip.js"],"sourcesContent":["const IPV4_PREFIX = '::ffff:';\nconst IPV4_LOCALHOST = '::1';\n\nconst ip = (options, app) => {\n    const requestIp = app.tryRequire('request-ip');\n\n    return async (ctx, next) => {\n        let ip = requestIp.getClientIp(ctx.req);\n\n        if (ip.startsWith(IPV4_PREFIX)) {\n            ip = ip.substring(IPV4_PREFIX.length);\n        }\n\n        if (ip === IPV4_LOCALHOST) {\n            ip = '127.0.0.1';\n        }\n\n        ctx.request.ip = ip;\n        ctx.req.info = { remoteAddress: ip, remotePort: ctx.req.socket.remotePort };\n        return next();\n    };\n};\n\nexport default ip;\n"],"names":["IPV4_PREFIX","IPV4_LOCALHOST","ip","options","app","requestIp","tryRequire","ctx","next","getClientIp","req","startsWith","substring","length","request","info","remoteAddress","remotePort","socket"],"mappings":"oGAuBA,iDAAA,YAvBA,MAAMA,YAAc,UACpB,MAAMC,eAAiB,MAEvB,MAAMC,GAAK,CAACC,QAASC,MAAQ,CACzB,MAAMC,UAAYD,IAAIE,UAAU,CAAC,cAEjC,OAAO,MAAOC,IAAKC,OAAS,CACxB,IAAIN,GAAKG,UAAUI,WAAW,CAACF,IAAIG,GAAG,EAEtC,GAAIR,GAAGS,UAAU,CAACX,aAAc,CAC5BE,GAAKA,GAAGU,SAAS,CAACZ,YAAYa,MAAM,CACxC,CAAC,AAED,GAAIX,KAAOD,eAAgB,CACvBC,GAAK,WACT,CAAC,AAEDK,IAAIO,OAAO,CAACZ,EAAE,CAAGA,EACjBK,CAAAA,IAAIG,GAAG,CAACK,IAAI,CAAG,CAAEC,cAAed,GAAIe,WAAYV,IAAIG,GAAG,CAACQ,MAAM,CAACD,UAAU,AAAC,EAC1E,OAAOT,MACX,CACJ,QAEA,SAAeN"}
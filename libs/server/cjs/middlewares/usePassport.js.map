{"version":3,"sources":["../../lib/middlewares/usePassport.js"],"sourcesContent":["import { InvalidConfiguration } from '@galaxar/types';\n\n/**\n * Passport initialization middleware, use the passport service exposed by other app to server.\n * @module Middleware_ServerPassport\n */\n\nconst middlewareName = 'middlewares.usePassport';\n\n/**\n * Create a passport authentication middleware.\n * @param {object} opt - Passport options\n * @property {string} opt.strategy - Passport strategy\n * @property {object} [opt.options] - Passport strategy options\n * @property {object} [opt.customHandler] - Flag to use passport strategy customHandler\n * @param {Routable} app\n * @returns {KoaActionFunction}\n */\nconst usePassport = (opt, app) => {\n    // if this app has no passport service, it will fallback to server\n    if (app.getService('passport', true /* currentModuleOnly*/) != null) {\n        throw new InvalidConfiguration('Passport middlewares has already been used if the passport service is enabled in this app.', app, middlewareName);\n    }\n\n    if (app.host == null) {\n        throw new InvalidConfiguration('\"usePassport\" middleware can only be used in an app module.', app, middlewareName);\n    }\n\n    const passportService = app.host.getService('passport');\n\n    if (!passportService) {\n        throw new InvalidConfiguration('Passport feature is not enabled.', app, middlewareName);\n    }\n\n    return passportService.middlewares;\n};\n\nexport default usePassport;\n"],"names":["middlewareName","usePassport","opt","app","getService","InvalidConfiguration","host","passportService","middlewares"],"mappings":";;;;+BAqCA;;;eAAA;;;uBArCqC;AAErC;;;CAGC,GAED,MAAMA,iBAAiB;AAEvB;;;;;;;;CAQC,GACD,MAAMC,cAAc,CAACC,KAAKC,MAAQ;IAC9B,kEAAkE;IAClE,IAAIA,IAAIC,UAAU,CAAC,YAAY,IAAI,KAA4B,IAAI,EAAE;QACjE,MAAM,IAAIC,2BAAoB,CAAC,8FAA8FF,KAAKH,gBAAgB;IACtJ,CAAC;IAED,IAAIG,IAAIG,IAAI,IAAI,IAAI,EAAE;QAClB,MAAM,IAAID,2BAAoB,CAAC,+DAA+DF,KAAKH,gBAAgB;IACvH,CAAC;IAED,MAAMO,kBAAkBJ,IAAIG,IAAI,CAACF,UAAU,CAAC;IAE5C,IAAI,CAACG,iBAAiB;QAClB,MAAM,IAAIF,2BAAoB,CAAC,oCAAoCF,KAAKH,gBAAgB;IAC5F,CAAC;IAED,OAAOO,gBAAgBC,WAAW;AACtC;MAEA,WAAeP"}
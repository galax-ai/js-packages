{"version":3,"sources":["../src/fetchagent.js"],"sourcesContent":["import ResponseWrapper, { isJSON } from './helpers/superagentLike';\nimport { appendQuery } from '@galaxar/utils';\n\nconst wretchAdapter = () => {\n    return {\n        createRequest(method, url, _options) {\n            const headers = {\n                'content-type': 'application/json',\n            };\n\n            let query;\n\n            const options = {\n                redirect: \"follow\", // manual, *follow, error\n            };\n\n            const requestWrapper = {\n                set: (name, value) => {\n                    let lowerName = name.toLowerCase();\n                    if (lowerName === 'type') {\n                        lowerName = 'content-type';\n                    }\n                    headers[lowerName] = value;\n                    return requestWrapper;\n                },\n                withCredentials: () => {\n                    options.mode = 'cors';\n                    options.credentials = 'include';\n                    return requestWrapper;\n                },\n                send: (body) => {\n                    if (isJSON(headers['content-type'])) {\n                        options.body = JSON.stringify(body);\n                    } else {\n                        options.body = body;\n                    }\n                    return requestWrapper;\n                },\n                query: (_query) => {\n                    query = query;\n                    return requestWrapper;\n                },\n                type: (type) => {\n                    headers['content-type'] = type;\n                    return requestWrapper;\n                },\n                accept: (type) => {\n                    headers.accept = type.includes('/') ? type : `application/${type}`;\n                    return requestWrapper;\n                },\n                then: async (callback) => {\n                    console.log(_options);\n\n                    if (_options._method === 'download' && !headers.accept) {\n                        requestWrapper.accept('octet-stream');\n                    }\n\n                    console.log(query ? appendQuery(url, query) : url, method, headers, options);\n\n                    const response = await fetch(query ? appendQuery(url, query) : url, {\n                        ...options,\n                        method: method.toUpperCase(), // *GET, POST, PUT, DELETE, etc.\n                        headers,\n                    });                                      \n                    \n                    return ResponseWrapper.create_(requestWrapper, response).then(callback);\n                }\n            };\n\n            return requestWrapper;\n        },\n    };\n};\n\nexport default wretchAdapter;\n"],"names":["wretchAdapter","createRequest","method","url","_options","headers","query","options","redirect","requestWrapper","set","name","value","lowerName","toLowerCase","withCredentials","mode","credentials","send","body","isJSON","JSON","stringify","_query","type","accept","includes","then","callback","console","log","_method","appendQuery","response","fetch","toUpperCase","ResponseWrapper","create_"],"mappings":";;;;+BA0EA;;;eAAA;;;wEA1EwC;uBACZ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE5B,MAAMA,gBAAgB,IAAM;IACxB,OAAO;QACHC,eAAcC,MAAM,EAAEC,GAAG,EAAEC,QAAQ,EAAE;YACjC,MAAMC,UAAU;gBACZ,gBAAgB;YACpB;YAEA,IAAIC;YAEJ,MAAMC,UAAU;gBACZC,UAAU;YACd;YAEA,MAAMC,iBAAiB;gBACnBC,KAAK,CAACC,MAAMC,QAAU;oBAClB,IAAIC,YAAYF,KAAKG,WAAW;oBAChC,IAAID,cAAc,QAAQ;wBACtBA,YAAY;oBAChB,CAAC;oBACDR,OAAO,CAACQ,UAAU,GAAGD;oBACrB,OAAOH;gBACX;gBACAM,iBAAiB,IAAM;oBACnBR,QAAQS,IAAI,GAAG;oBACfT,QAAQU,WAAW,GAAG;oBACtB,OAAOR;gBACX;gBACAS,MAAM,CAACC,OAAS;oBACZ,IAAIC,IAAAA,sBAAM,EAACf,OAAO,CAAC,eAAe,GAAG;wBACjCE,QAAQY,IAAI,GAAGE,KAAKC,SAAS,CAACH;oBAClC,OAAO;wBACHZ,QAAQY,IAAI,GAAGA;oBACnB,CAAC;oBACD,OAAOV;gBACX;gBACAH,OAAO,CAACiB,SAAW;oBACfjB,QAAQA;oBACR,OAAOG;gBACX;gBACAe,MAAM,CAACA,OAAS;oBACZnB,OAAO,CAAC,eAAe,GAAGmB;oBAC1B,OAAOf;gBACX;gBACAgB,QAAQ,CAACD,OAAS;oBACdnB,QAAQoB,MAAM,GAAGD,KAAKE,QAAQ,CAAC,OAAOF,OAAO,CAAC,YAAY,EAAEA,KAAK,CAAC;oBAClE,OAAOf;gBACX;gBACAkB,MAAM,OAAOC,WAAa;oBACtBC,QAAQC,GAAG,CAAC1B;oBAEZ,IAAIA,SAAS2B,OAAO,KAAK,cAAc,CAAC1B,QAAQoB,MAAM,EAAE;wBACpDhB,eAAegB,MAAM,CAAC;oBAC1B,CAAC;oBAEDI,QAAQC,GAAG,CAACxB,QAAQ0B,IAAAA,kBAAW,EAAC7B,KAAKG,SAASH,GAAG,EAAED,QAAQG,SAASE;oBAEpE,MAAM0B,WAAW,MAAMC,MAAM5B,QAAQ0B,IAAAA,kBAAW,EAAC7B,KAAKG,SAASH,GAAG,EAAE;wBAChE,GAAGI,OAAO;wBACVL,QAAQA,OAAOiC,WAAW;wBAC1B9B;oBACJ;oBAEA,OAAO+B,uBAAe,CAACC,OAAO,CAAC5B,gBAAgBwB,UAAUN,IAAI,CAACC;gBAClE;YACJ;YAEA,OAAOnB;QACX;IACJ;AACJ;MAEA,WAAeT"}
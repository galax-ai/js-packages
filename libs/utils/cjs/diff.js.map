{"version":3,"sources":["../diff.js"],"sourcesContent":["import _isEqual from 'lodash/isEqual';\nimport _reduce from 'lodash/reduce';\nimport _isEmpty from 'lodash/isEmpty';\nimport _differenceWith from 'lodash/differenceWith';\n\nimport ifThen from './ifThen';\n\nconst arrayOperators = [() => [], (array, k, v) => array.push(v)];\nconst objectOperators = [() => ({}), (obj, k, v) => (obj[k] = v)];\n\nfunction _diff(base, object, creator, setter) {\n    return _reduce(\n        object,\n        (re, v, k) => {\n            const vb = base[k];\n            const tb = typeof vb;\n            const to = typeof v;\n\n            if (tb !== to) {\n                // different type at all\n                setter(re, k, v);\n            } else if (typeof vb === 'object') {\n                // both are object\n                if (Array.isArray(vb)) {\n                    // both are array\n                    const avd = _differenceWith(v, vb, _isEqual);\n                    if (avd.length > 0) {\n                        setter(re, k, avd);\n                    }\n                } else if (!_isEqual(vb, v)) {\n                    // object\n                    const baseIsEmpty = _isEmpty(vb);\n\n                    if (_isEmpty(v)) {\n                        if (!baseIsEmpty) {\n                            setter(re, k, v);\n                        }\n                    } else {\n                        if (baseIsEmpty) {\n                            setter(re, k, v);\n                        } else {\n                            // both not empty\n                            const vd = _diff(vb, v, objectOperators[0], objectOperators[1]);\n                            if (!_isEmpty(vd)) {\n                                setter(re, k, vd);\n                            }\n                        }\n                    }\n                }\n            } else if (vb !== v) {\n                setter(re, k, v);\n            }\n\n            return re;\n        },\n        creator()\n    );\n}\n\n/**\n * Deep diff between two object\n * @alias object.difference\n * @param  {Object} base - Object to be compared\n * @param  {Object} object - Object compared\n * @return {Object} Return the key-value pair from object which of the value is different from base with the same key, or undefined if no difference\n */\nfunction difference(base, object) {\n    const ops = Array.isArray(base) ? arrayOperators : objectOperators;\n    const baseIsEmpty = _isEmpty(base);\n    return _isEmpty(object)\n        ? baseIsEmpty\n            ? undefined\n            : object\n        : baseIsEmpty\n        ? object\n        : ifThen(_diff(base, object, ops[0], ops[1]), _isEmpty, undefined);\n}\n\nexport default difference;\n"],"names":["arrayOperators","array","k","v","push","objectOperators","obj","_diff","base","object","creator","setter","_reduce","re","vb","tb","to","Array","isArray","avd","_differenceWith","_isEqual","length","baseIsEmpty","_isEmpty","vd","difference","ops","undefined","ifThen"],"mappings":"oGA8EA,iDAAA,4DA9EqB,kEACD,kEACC,0EACO,yEAET,iGAEnB,MAAMA,eAAiB,CAAC,IAAM,EAAE,CAAE,CAACC,MAAOC,EAAGC,IAAMF,MAAMG,IAAI,CAACD,GAAG,CACjE,MAAME,gBAAkB,CAAC,IAAO,CAAA,CAAC,CAAA,EAAI,CAACC,IAAKJ,EAAGC,IAAOG,GAAG,CAACJ,EAAE,CAAGC,EAAG,CAEjE,SAASI,MAAMC,IAAI,CAAEC,MAAM,CAAEC,OAAO,CAAEC,MAAM,CAAE,CAC1C,MAAOC,GAAAA,eAAO,EACVH,OACA,CAACI,GAAIV,EAAGD,IAAM,CACV,MAAMY,GAAKN,IAAI,CAACN,EAAE,CAClB,MAAMa,GAAK,OAAOD,GAClB,MAAME,GAAK,OAAOb,EAElB,GAAIY,KAAOC,GAAI,CAEXL,OAAOE,GAAIX,EAAGC,EAClB,MAAO,GAAI,OAAOW,KAAO,SAAU,CAE/B,GAAIG,MAAMC,OAAO,CAACJ,IAAK,CAEnB,MAAMK,IAAMC,GAAAA,uBAAe,EAACjB,EAAGW,GAAIO,gBAAQ,EAC3C,GAAIF,IAAIG,MAAM,CAAG,EAAG,CAChBX,OAAOE,GAAIX,EAAGiB,IAClB,CAAC,AACL,MAAO,GAAI,CAACE,GAAAA,gBAAQ,EAACP,GAAIX,GAAI,CAEzB,MAAMoB,YAAcC,GAAAA,gBAAQ,EAACV,IAE7B,GAAIU,GAAAA,gBAAQ,EAACrB,GAAI,CACb,GAAI,CAACoB,YAAa,CACdZ,OAAOE,GAAIX,EAAGC,EAClB,CAAC,AACL,KAAO,CACH,GAAIoB,YAAa,CACbZ,OAAOE,GAAIX,EAAGC,EAClB,KAAO,CAEH,MAAMsB,GAAKlB,MAAMO,GAAIX,EAAGE,eAAe,CAAC,EAAE,CAAEA,eAAe,CAAC,EAAE,EAC9D,GAAI,CAACmB,GAAAA,gBAAQ,EAACC,IAAK,CACfd,OAAOE,GAAIX,EAAGuB,GAClB,CAAC,AACL,CAAC,AACL,CAAC,AACL,CAAC,AACL,MAAO,GAAIX,KAAOX,EAAG,CACjBQ,OAAOE,GAAIX,EAAGC,EAClB,CAAC,AAED,OAAOU,EACX,EACAH,UAER,CASA,SAASgB,WAAWlB,IAAI,CAAEC,MAAM,CAAE,CAC9B,MAAMkB,IAAMV,MAAMC,OAAO,CAACV,MAAQR,eAAiBK,eAAe,CAClE,MAAMkB,YAAcC,GAAAA,gBAAQ,EAAChB,MAC7B,MAAOgB,GAAAA,gBAAQ,EAACf,QACVc,YACIK,UACAnB,MAAM,CACVc,YACAd,OACAoB,GAAAA,eAAM,EAACtB,MAAMC,KAAMC,OAAQkB,GAAG,CAAC,EAAE,CAAEA,GAAG,CAAC,EAAE,EAAGH,gBAAQ,CAAEI,UAAU,AAC1E,OAEA,SAAeF"}
{"version":3,"sources":["../lib/Graph.js"],"sourcesContent":["import { _ } from '@galaxar/utils';\nimport TopoSort from './TopoSort';\n\nclass Graph {\n    constructor(json) {\n        this.topo = new TopoSort();\n\n        if (json) {\n            this.nodes = _.cloneDeep(json.nodes);\n            if (!_.isEmpty(json.edges)) {\n                _.forOwn(json.edges, (targets, source) => {\n                    this.topo.add(source, targets);\n                });\n            }\n            this.startNodes = json.startNodes;\n            this.endNodes = json.endNodes;\n        } else {\n            this.nodes = {};\n        }\n    }\n\n    hasNode(key) {\n        return key in this.nodes;\n    }\n\n    getNode(key) {\n        return this.nodes[key];\n    }\n\n    setNode(key, value) {\n        this.nodes[key] = value;\n        return this;\n    }\n\n    setEdge(sourceNode, targetNode) {\n        if (!this.hasNode(sourceNode)) {\n            throw new Error(`Source node [${sourceNode}] not exists.`);\n        }\n        if (!this.hasNode(targetNode)) {\n            throw new Error(`Target node [${targetNode}] not exists.`);\n        }\n        this.topo.add(sourceNode, targetNode);\n        return this;\n    }\n\n    getTargetNodes(sourceNode) {\n        return Array.from(this.topo.mapOfDependents[sourceNode]);\n    }\n\n    getSourceNodes(targetNode) {\n        return Array.from(this.topo.mapOfDependencies[targetNode]);\n    }\n\n    calcStartEnd() {\n        const seq = this.topo.sort();\n        this.startNodes = _.takeWhile(seq, (e) => !this.topo.hasDependency(e));\n        this.endNodes = _.takeRightWhile(\n            seq,\n            (e) => !this.topo.hasDependent(e)\n        );\n\n        if (this.startNodes.length === 0) {\n            this.startNodes = Object.keys(this.nodes);\n        }\n\n        if (this.endNodes.length === 0) {\n            this.endNodes = Object.keys(this.nodes);\n        }\n\n        return this;\n    }\n\n    toJSON() {\n        return {\n            nodes: this.nodes,\n            edges: _.mapValues(this.topo.mapOfDependents, (nodes) =>\n                Array.from(nodes)\n            ),\n            startNodes: this.startNodes,\n            endNodes: this.endNodes,\n        };\n    }\n}\n\nexport default Graph;\n"],"names":["Graph","hasNode","key","nodes","getNode","setNode","value","setEdge","sourceNode","targetNode","Error","topo","add","getTargetNodes","Array","from","mapOfDependents","getSourceNodes","mapOfDependencies","calcStartEnd","seq","sort","startNodes","_","takeWhile","e","hasDependency","endNodes","takeRightWhile","hasDependent","length","Object","keys","toJSON","edges","mapValues","constructor","json","TopoSort","cloneDeep","isEmpty","forOwn","targets","source"],"mappings":"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"}
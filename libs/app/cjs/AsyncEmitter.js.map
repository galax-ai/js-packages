{"version":3,"sources":["../lib/AsyncEmitter.js"],"sourcesContent":["import { pushIntoBucket, batchAsync_ } from '@galaxar/utils';\n\nclass AsyncEmitter {\n    constructor() {\n        this._handlers = {};\n    }\n\n    on(event, handler) {\n        pushIntoBucket(this._handlers, event, { once: false, handler });\n        return this;\n    }\n\n    once(event, handler) {\n        pushIntoBucket(this._handlers, event, { once: true, handler });\n        return this;\n    }\n\n    off(event, handler) {\n        let handlers = this._handlers[event];\n        if (!handlers || handlers.length === 0) {\n            return this;\n        }\n\n        if (handler) {\n            let index = handlers.findIndex((item) => item.handler === handler);\n            if (index >= 0) {\n                handlers.splice(index, 1);\n            }\n        } else {\n            delete this._handlers[event];\n        }\n\n        return this;\n    }\n\n    allOff() {\n        this._handlers = {};\n        return this;\n    }\n\n    async emit_(event, ...args) {\n        let handlers = this._handlers[event];\n        if (!handlers || handlers.length === 0) {\n            return false;\n        }\n\n        const _handlers = [...handlers];\n        this._handlers[event] = handlers.filter((item) => !item.once);\n\n        await batchAsync_(_handlers, (item) => item.handler(...args));\n\n        return true;\n    }\n}\n\nexport default AsyncEmitter;\n"],"names":["AsyncEmitter","on","event","handler","pushIntoBucket","_handlers","once","off","handlers","length","index","findIndex","item","splice","allOff","emit_","args","filter","batchAsync_","constructor"],"mappings":"oGAuDA,iDAAA,iCAvD4C,iBAE5C,OAAMA,aAKFC,GAAGC,KAAK,CAAEC,OAAO,CAAE,CACfC,GAAAA,qBAAc,EAAC,IAAI,CAACC,SAAS,CAAEH,MAAO,CAAEI,KAAM,KAAK,CAAEH,OAAQ,GAC7D,OAAO,IAAI,AACf,CAEAG,KAAKJ,KAAK,CAAEC,OAAO,CAAE,CACjBC,GAAAA,qBAAc,EAAC,IAAI,CAACC,SAAS,CAAEH,MAAO,CAAEI,KAAM,IAAI,CAAEH,OAAQ,GAC5D,OAAO,IAAI,AACf,CAEAI,IAAIL,KAAK,CAAEC,OAAO,CAAE,CAChB,IAAIK,SAAW,IAAI,CAACH,SAAS,CAACH,MAAM,CACpC,GAAI,CAACM,UAAYA,SAASC,MAAM,GAAK,EAAG,CACpC,OAAO,IAAI,AACf,CAAC,AAED,GAAIN,QAAS,CACT,IAAIO,MAAQF,SAASG,SAAS,CAAC,AAACC,MAASA,KAAKT,OAAO,GAAKA,SAC1D,GAAIO,OAAS,EAAG,CACZF,SAASK,MAAM,CAACH,MAAO,EAC3B,CAAC,AACL,KAAO,CACH,OAAO,IAAI,CAACL,SAAS,CAACH,MAAM,AAChC,CAAC,AAED,OAAO,IAAI,AACf,CAEAY,QAAS,CACL,IAAI,CAACT,SAAS,CAAG,CAAC,EAClB,OAAO,IAAI,AACf,CAEA,MAAMU,MAAMb,KAAK,CAAE,GAAGc,IAAI,CAAE,CACxB,IAAIR,SAAW,IAAI,CAACH,SAAS,CAACH,MAAM,CACpC,GAAI,CAACM,UAAYA,SAASC,MAAM,GAAK,EAAG,CACpC,OAAO,KAAK,AAChB,CAAC,AAED,MAAMJ,UAAY,IAAIG,SAAS,AAC/B,CAAA,IAAI,CAACH,SAAS,CAACH,MAAM,CAAGM,SAASS,MAAM,CAAC,AAACL,MAAS,CAACA,KAAKN,IAAI,CAE5D,OAAMY,GAAAA,kBAAW,EAACb,UAAW,AAACO,MAASA,KAAKT,OAAO,IAAIa,OAEvD,OAAO,IAAI,AACf,CAjDAG,aAAc,CACV,IAAI,CAACd,SAAS,CAAG,CAAC,CACtB,CAgDJ,OAEA,SAAeL"}
{"version":3,"sources":["../../lib/features/jwt.js"],"sourcesContent":["import { Feature } from '@galaxar/app';\n\nexport default {\n    stage: Feature.INIT,\n\n    groupable: true,\n\n    load_: async function (app, options, name) {\n        let { key, privateKey, publicKey } = app.featureConfig(\n            options,\n            {\n                schema: [\n                    {\n                        key: { type: 'text' },\n                    },\n                    {\n                        privateKey: { type: 'text', mod: ['|trimLines'] },\n                        publicKey: { type: 'text', mod: ['|trimLines'] },\n                    },\n                ],\n            },\n            name\n        );\n\n        let asymmetric = false;\n\n        if (key) {\n            privateKey = key;\n            publicKey = key;\n        } else {\n            asymmetric = true;\n        }\n\n        const jwt = app.tryRequire('jsonwebtoken');\n\n        const service = {\n            get publicKey() {\n                return publicKey;\n            },\n            sign: (payload, options) => {\n                return jwt.sign(payload, privateKey, asymmetric ? { algorithm: 'RS256', ...options } : options);\n            },\n            verify: (token, options) => {\n                return jwt.verify(token, publicKey, asymmetric ? { algorithm: 'RS256', ...options } : options);\n            },\n        };\n\n        app.registerService(name, service);\n    },\n};\n"],"names":["stage","Feature","INIT","groupable","load_","app","options","name","key","privateKey","publicKey","featureConfig","schema","type","mod","asymmetric","jwt","tryRequire","service","sign","payload","algorithm","verify","token","registerService"],"mappings":";;;;+BAEA;;;eAAA;;;qBAFwB;MAExB,WAAe;IACXA,OAAOC,YAAO,CAACC,IAAI;IAEnBC,WAAW,IAAI;IAEfC,OAAO,eAAgBC,GAAG,EAAEC,OAAO,EAAEC,IAAI,EAAE;QACvC,IAAI,EAAEC,IAAG,EAAEC,WAAU,EAAEC,UAAS,EAAE,GAAGL,IAAIM,aAAa,CAClDL,SACA;YACIM,QAAQ;gBACJ;oBACIJ,KAAK;wBAAEK,MAAM;oBAAO;gBACxB;gBACA;oBACIJ,YAAY;wBAAEI,MAAM;wBAAQC,KAAK;4BAAC;yBAAa;oBAAC;oBAChDJ,WAAW;wBAAEG,MAAM;wBAAQC,KAAK;4BAAC;yBAAa;oBAAC;gBACnD;aACH;QACL,GACAP;QAGJ,IAAIQ,aAAa,KAAK;QAEtB,IAAIP,KAAK;YACLC,aAAaD;YACbE,YAAYF;QAChB,OAAO;YACHO,aAAa,IAAI;QACrB,CAAC;QAED,MAAMC,MAAMX,IAAIY,UAAU,CAAC;QAE3B,MAAMC,UAAU;YACZ,IAAIR,aAAY;gBACZ,OAAOA;YACX;YACAS,MAAM,CAACC,SAASd,UAAY;gBACxB,OAAOU,IAAIG,IAAI,CAACC,SAASX,YAAYM,aAAa;oBAAEM,WAAW;oBAAS,GAAGf,OAAO;gBAAC,IAAIA,OAAO;YAClG;YACAgB,QAAQ,CAACC,OAAOjB,UAAY;gBACxB,OAAOU,IAAIM,MAAM,CAACC,OAAOb,WAAWK,aAAa;oBAAEM,WAAW;oBAAS,GAAGf,OAAO;gBAAC,IAAIA,OAAO;YACjG;QACJ;QAEAD,IAAImB,eAAe,CAACjB,MAAMW;IAC9B;AACJ"}
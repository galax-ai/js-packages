{"version":3,"sources":["../../lib/features/serviceGroup.js"],"sourcesContent":["import { _, eachAsync_, batchAsync_ } from \"@galaxar/utils\";\nimport Feature from \"../Feature\";\n\n\n/**\n * Enable a service group\n * @module Feature_ServiceGroup\n */\n\nmodule.exports = {\n    /**\n     * This feature is loaded at service stage\n     * @member {string}\n     */\n    stage: Feature.SERVICE,\n\n    /**\n     * Load the feature\n     * @param {App} app - The app module object\n     * @param {object} services - Map of services from service registration to service instance options\n     * @returns {Promise.<*>}\n     *\n     * @example\n     *\n     * serviceGroup: { 's3DigitalOcean': { '<instanceName>': {  } }   }\n     */\n    load_: async function (app, services) {\n        let features = [];\n        const instancesMap = {};\n\n        _.each(services, (instances, serviceName) => {\n            let feature = app._loadFeature(serviceName);\n            features.push(feature);\n            instancesMap[serviceName] = instances;\n        });\n\n        features = app._sortFeatures(features);\n\n        await eachAsync_(features, async (feature) => {\n            const instances = instancesMap[feature.name];\n            await batchAsync_(instances, (serviceOptions, instanceName) =>\n                feature.load_(app, serviceOptions, `${serviceName}-${instanceName}`)\n            );\n        });\n    },\n};\n"],"names":["module","exports","stage","Feature","SERVICE","load_","app","services","features","instancesMap","_","each","instances","serviceName","feature","_loadFeature","push","_sortFeatures","eachAsync_","name","batchAsync_","serviceOptions","instanceName"],"mappings":"2FAA2C,kEACvB,mGAQpBA,OAAOC,OAAO,CAAG,CAKbC,MAAOC,gBAAO,CAACC,OAAO,CAYtBC,MAAO,eAAgBC,GAAG,CAAEC,QAAQ,CAAE,CAClC,IAAIC,SAAW,EAAE,CACjB,MAAMC,aAAe,CAAC,EAEtBC,QAAC,CAACC,IAAI,CAACJ,SAAU,CAACK,UAAWC,eAAgB,CACzC,IAAIC,QAAUR,IAAIS,YAAY,CAACF,cAC/BL,SAASQ,IAAI,CAACF,QACdL,CAAAA,YAAY,CAACI,aAAY,CAAGD,SAChC,GAEAJ,SAAWF,IAAIW,aAAa,CAACT,SAE7B,OAAMU,GAAAA,iBAAU,EAACV,SAAU,MAAOM,SAAY,CAC1C,MAAMF,UAAYH,YAAY,CAACK,QAAQK,IAAI,CAAC,AAC5C,OAAMC,GAAAA,kBAAW,EAACR,UAAW,CAACS,eAAgBC,eAC1CR,QAAQT,KAAK,CAACC,IAAKe,eAAgB,CAAC,EAAER,YAAY,CAAC,EAAES,aAAa,CAAC,EAE3E,EACJ,CACJ"}
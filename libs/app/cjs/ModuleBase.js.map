{"version":3,"sources":["../lib/ModuleBase.js"],"sourcesContent":["import path from 'node:path';\n\nconst ModuleBase = (Base) =>\n    class extends Base {\n        /**\n         * @param {Runnable} hostApp\n         * @param {string} name - The name of the app module.\n         * @param {string} route - The base route of the app module.\n         * @param {string} appPath - The path to load the app's module files\n         * @param {object} [options] - The app module's extra options defined in its parent's configuration.\n         */\n        constructor(hostApp, name, appPath, options) {\n            super(name, {\n                workingPath: appPath,\n                configPath: path.join(appPath, 'conf'),\n                sourcePath: './',\n                ...options,\n            });\n\n            /**\n             * Hosting app.\n             * @member {Runnable}\n             **/\n            this.host = hostApp;\n\n            /**\n             * Whether it is a server.\n             * @member {boolean}\n             **/\n            this.isServer = false;\n\n            /**\n             * Source files path.\n             * @member {string}\n             **/\n            this.sourcePath = this.toAbsolutePath(this.options.sourcePath);\n\n            this.featuresPath = path.resolve(this.sourcePath, this.options.featuresPath);\n\n            this.logger = this.host.logger?.child({ module: this.name }, { level: this.options.logLevel });\n            this.log = (level, message, info) => {\n                this.logger ? this.logger[level](info, message) : this.host.log(level, message, info);\n                return this;\n            };\n        }\n\n        /**\n         * Get a service from module hierarchy\n         * @param name\n         * @returns {object}\n         */\n        getService(name, currentModuleOnly) {\n            return super.getService(name) || (!currentModuleOnly && this.host.getService(name));\n        }\n\n        /**\n         * Check whether a feature is enabled in the app or its hosting server.\n         * @param {string} feature\n         * @returns {bool}\n         */\n        enabled(feature, currentModuleOnly) {\n            return super.enabled(feature) || (!currentModuleOnly && this.host.enabled(feature));\n        }\n\n        /**\n         * Require a js module from backend path\n         * @param {*} relativePath\n         */\n        require(relativePath) {\n            let modPath = path.join(this.sourcePath, relativePath);\n            return require(modPath);\n        }\n\n        /**\n         * Require a module from the source path of a library module\n         * @param {*} relativePath\n         */\n        requireFromLib(libName, relativePath) {\n            return this.host.requireFromLib(libName, relativePath);\n        }\n    };\n\nexport default ModuleBase;\n"],"names":["ModuleBase","Base","getService","name","currentModuleOnly","host","enabled","feature","require","relativePath","modPath","path","join","sourcePath","requireFromLib","libName","constructor","hostApp","appPath","options","workingPath","configPath","isServer","toAbsolutePath","featuresPath","resolve","logger","child","module","level","logLevel","log","message","info"],"mappings":"oGAkFA,iDAAA,6DAlFiB,kGAEjB,MAAMA,WAAa,AAACC,OAChB,qBAAcA,KAgDVC,WAAWC,IAAI,CAAEC,iBAAiB,CAAE,CAChC,OAAO,KAAK,CAACF,UAAU,CAACC,OAAU,CAACC,mBAAqB,IAAI,CAACC,IAAI,CAACH,UAAU,CAACC,KACjF,CAOAG,QAAQC,OAAO,CAAEH,iBAAiB,CAAE,CAChC,OAAO,KAAK,CAACE,OAAO,CAACC,UAAa,CAACH,mBAAqB,IAAI,CAACC,IAAI,CAACC,OAAO,CAACC,QAC9E,CAMAC,QAAQC,YAAY,CAAE,CAClB,IAAIC,QAAUC,iBAAI,CAACC,IAAI,CAAC,IAAI,CAACC,UAAU,CAAEJ,cACzC,OAAOD,QAAQE,QACnB,CAMAI,eAAeC,OAAO,CAAEN,YAAY,CAAE,CAClC,OAAO,IAAI,CAACJ,IAAI,CAACS,cAAc,CAACC,QAASN,aAC7C,CApEAO,YAAYC,OAAO,CAAEd,IAAI,CAAEe,OAAO,CAAEC,OAAO,CAAE,CACzC,KAAK,CAAChB,KAAM,CACRiB,YAAaF,QACbG,WAAYV,iBAAI,CAACC,IAAI,CAACM,QAAS,QAC/BL,WAAY,KACZ,GAAGM,OAAO,AACd,EAMA,CAAA,IAAI,CAACd,IAAI,CAAGY,OAMZ,CAAA,IAAI,CAACK,QAAQ,CAAG,KAAK,AAMrB,CAAA,IAAI,CAACT,UAAU,CAAG,IAAI,CAACU,cAAc,CAAC,IAAI,CAACJ,OAAO,CAACN,UAAU,CAE7D,CAAA,IAAI,CAACW,YAAY,CAAGb,iBAAI,CAACc,OAAO,CAAC,IAAI,CAACZ,UAAU,CAAE,IAAI,CAACM,OAAO,CAACK,YAAY,CAE3E,CAAA,IAAI,CAACE,MAAM,CAAG,IAAI,CAACrB,IAAI,CAACqB,MAAM,EAAEC,MAAM,CAAEC,OAAQ,IAAI,CAACzB,IAAI,AAAC,EAAG,CAAE0B,MAAO,IAAI,CAACV,OAAO,CAACW,QAAQ,AAAC,EAC5F,CAAA,IAAI,CAACC,GAAG,CAAG,CAACF,MAAOG,QAASC,OAAS,CACjC,IAAI,CAACP,MAAM,CAAG,IAAI,CAACA,MAAM,CAACG,MAAM,CAACI,KAAMD,SAAW,IAAI,CAAC3B,IAAI,CAAC0B,GAAG,CAACF,MAAOG,QAASC,KAAK,CACrF,OAAO,IAAI,AACf,CACJ,CAoCJ,sBAEJ,SAAejC"}
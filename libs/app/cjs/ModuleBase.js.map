{"version":3,"sources":["../lib/ModuleBase.js"],"sourcesContent":["import path from 'node:path';\n\nconst ModuleBase = (Base) =>\n    class extends Base {\n        /**\n         * @param {Runnable} hostApp\n         * @param {string} name - The name of the app module.\n         * @param {string} route - The base route of the app module.\n         * @param {string} appPath - The path to load the app's module files\n         * @param {object} [options] - The app module's extra options defined in its parent's configuration.\n         */\n        constructor(hostApp, name, appPath, options) {\n            super(name, {\n                workingPath: appPath,\n                configPath: path.join(appPath, 'conf'),\n                sourcePath: './',\n                ...options,\n            });\n\n            /**\n             * Hosting app.\n             * @member {Runnable}\n             **/\n            this.host = hostApp;\n\n            /**\n             * Whether it is a server.\n             * @member {boolean}\n             **/\n            this.isServer = false;\n\n            this.featuresPath = path.resolve(this.sourcePath, this.options.featuresPath);\n\n            this.logger = this.host.logger?.child({ module: this.name }, { level: this.options.logLevel });\n            this.log = (level, message, info) => {\n                this.logger ? this.logger[level](info, message) : this.host.log(level, message, info);\n                return this;\n            };\n        }\n\n        /**\n         * Get a service from module hierarchy\n         * @param name\n         * @returns {object}\n         */\n        getService(name, currentModuleOnly) {\n            return super.getService(name) || (!currentModuleOnly && this.host.getService(name));\n        }\n\n        /**\n         * Check whether a feature is enabled in the app or its hosting server.\n         * @param {string} feature\n         * @returns {bool}\n         */\n        enabled(feature, currentModuleOnly) {\n            return super.enabled(feature) || (!currentModuleOnly && this.host.enabled(feature));\n        }\n\n        /**\n         * Require a js module from backend path\n         * @param {*} relativePath\n         */\n        require(relativePath) {\n            let modPath = path.join(this.sourcePath, relativePath);\n            return require(modPath);\n        }\n\n        /**\n         * Require a module from the source path of a library module\n         * @param {*} relativePath\n         */\n        requireFromLib(libName, relativePath) {\n            return this.host.requireFromLib(libName, relativePath);\n        }\n    };\n\nexport default ModuleBase;\n"],"names":["ModuleBase","Base","getService","name","currentModuleOnly","host","enabled","feature","require","relativePath","modPath","path","join","sourcePath","requireFromLib","libName","constructor","hostApp","appPath","options","workingPath","configPath","isServer","featuresPath","resolve","logger","child","module","level","logLevel","log","message","info"],"mappings":";;;;+BA4EA;;;eAAA;;;iEA5EiB;;;;;;AAEjB,MAAMA,aAAa,CAACC;IAChB,qBAAcA;QAqCV;;;;SAIC,GACDC,WAAWC,IAAI,EAAEC,iBAAiB,EAAE;YAChC,OAAO,KAAK,CAACF,UAAU,CAACC,SAAU,CAACC,qBAAqB,IAAI,CAACC,IAAI,CAACH,UAAU,CAACC;QACjF;QAEA;;;;SAIC,GACDG,QAAQC,OAAO,EAAEH,iBAAiB,EAAE;YAChC,OAAO,KAAK,CAACE,OAAO,CAACC,YAAa,CAACH,qBAAqB,IAAI,CAACC,IAAI,CAACC,OAAO,CAACC;QAC9E;QAEA;;;SAGC,GACDC,QAAQC,YAAY,EAAE;YAClB,IAAIC,UAAUC,iBAAI,CAACC,IAAI,CAAC,IAAI,CAACC,UAAU,EAAEJ;YACzC,OAAOD,QAAQE;QACnB;QAEA;;;SAGC,GACDI,eAAeC,OAAO,EAAEN,YAAY,EAAE;YAClC,OAAO,IAAI,CAACJ,IAAI,CAACS,cAAc,CAACC,SAASN;QAC7C;QArEA;;;;;;SAMC,GACDO,YAAYC,OAAO,EAAEd,IAAI,EAAEe,OAAO,EAAEC,OAAO,CAAE;YACzC,KAAK,CAAChB,MAAM;gBACRiB,aAAaF;gBACbG,YAAYV,iBAAI,CAACC,IAAI,CAACM,SAAS;gBAC/BL,YAAY;gBACZ,GAAGM,OAAO;YACd;YAEA;;;cAGE,GACF,IAAI,CAACd,IAAI,GAAGY;YAEZ;;;cAGE,GACF,IAAI,CAACK,QAAQ,GAAG,KAAK;YAErB,IAAI,CAACC,YAAY,GAAGZ,iBAAI,CAACa,OAAO,CAAC,IAAI,CAACX,UAAU,EAAE,IAAI,CAACM,OAAO,CAACI,YAAY;YAE3E,IAAI,CAACE,MAAM,GAAG,IAAI,CAACpB,IAAI,CAACoB,MAAM,EAAEC,MAAM;gBAAEC,QAAQ,IAAI,CAACxB,IAAI;YAAC,GAAG;gBAAEyB,OAAO,IAAI,CAACT,OAAO,CAACU,QAAQ;YAAC;YAC5F,IAAI,CAACC,GAAG,GAAG,CAACF,OAAOG,SAASC,OAAS;gBACjC,IAAI,CAACP,MAAM,GAAG,IAAI,CAACA,MAAM,CAACG,MAAM,CAACI,MAAMD,WAAW,IAAI,CAAC1B,IAAI,CAACyB,GAAG,CAACF,OAAOG,SAASC,KAAK;gBACrF,OAAO,IAAI;YACf;QACJ;IAoCJ;;;MAEJ,WAAehC"}
{"version":3,"sources":["../../lib/starters/worker.js"],"sourcesContent":["import App from '../App';\n\n/**\n * Start a worker app\n * @param {Function} worker \n * @param {object} [workerOptions] \n * @property {string} [workerOptions.workerName]\n * @property {boolean} [workerOptions.dontStop] - Don't stop after worker done \n * @property {Function} [workerOptions.initializer] \n */\nasync function startWorker(worker, options) {\n    const { workerName, dontStop, initializer, uninitializer, throwOnError, verbose, ...appOptions } = (options || {});\n\n    if (verbose) {\n        appOptions.logLevel = 'verbose';\n    }\n\n    // create an app instance with custom configuration\n    let app = new App(workerName || 'worker', appOptions);\n\n    try {\n        await app.start_();\n    \n        if (initializer) {\n            await initializer(app);\n        }    \n        \n        const result = await worker(app);\n        \n        if (dontStop) {\n            process.on('SIGINT', () => {\n                app.stop_();\n            });     \n        } else {           \n            await app.stop_();\n        }\n\n        if (uninitializer) {\n            await uninitializer();\n        }\n\n        return result;\n    } catch (error) {\n        if (throwOnError) {\n            throw error;\n        }\n        \n        console.error(verbose ? error : error.message);\n\n        process.exit(1);\n    } \n}\n\nexport default startWorker;"],"names":["startWorker","worker","options","workerName","dontStop","initializer","uninitializer","throwOnError","verbose","appOptions","logLevel","app","App","start_","result","process","on","stop_","error","console","message","exit"],"mappings":"oGAqDA,iDAAA,wDArDgB,+FAUhB,eAAeA,YAAYC,MAAM,CAAEC,OAAO,CAAE,CACxC,KAAM,CAAEC,UAAU,CAAEC,QAAQ,CAAEC,WAAW,CAAEC,aAAa,CAAEC,YAAY,CAAEC,OAAO,CAAE,GAAGC,WAAY,CAAIP,SAAW,CAAC,EAEhH,GAAIM,QAAS,CACTC,WAAWC,QAAQ,CAAG,SAC1B,CAAC,AAGD,IAAIC,IAAM,IAAIC,YAAG,CAACT,YAAc,SAAUM,YAE1C,GAAI,CACA,MAAME,IAAIE,MAAM,GAEhB,GAAIR,YAAa,CACb,MAAMA,YAAYM,IACtB,CAAC,AAED,MAAMG,OAAS,MAAMb,OAAOU,KAE5B,GAAIP,SAAU,CACVW,QAAQC,EAAE,CAAC,SAAU,IAAM,CACvBL,IAAIM,KAAK,EACb,EACJ,KAAO,CACH,MAAMN,IAAIM,KAAK,EACnB,CAAC,AAED,GAAIX,cAAe,CACf,MAAMA,eACV,CAAC,AAED,OAAOQ,MACX,CAAE,MAAOI,MAAO,CACZ,GAAIX,aAAc,CACd,MAAMW,KAAM,AAChB,CAAC,AAEDC,QAAQD,KAAK,CAACV,QAAUU,MAAQA,MAAME,OAAO,EAE7CL,QAAQM,IAAI,CAAC,EACjB,CACJ,OAEA,SAAerB"}
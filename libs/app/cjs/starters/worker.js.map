{"version":3,"sources":["../../lib/starters/worker.js"],"sourcesContent":["/**\n * Start a worker app\n * @param {Function} worker \n * @param {object} [workerOptions] \n * @property {string} [workerOptions.workerName]\n * @property {boolean} [workerOptions.dontStop] - Don't stop after worker done \n * @property {Function} [workerOptions.initializer] \n */\nasync function startWorker(worker, options) {\n    const { workerName, dontStop, initializer, uninitializer, throwOnError, verbose, ...appOptions } = (options || {});\n\n    if (verbose) {\n        appOptions.logger = {\n            ...appOptions.logger,\n            level: 'verbose',\n        };\n    }\n\n    const App = require('..');\n\n    // create an app instance with custom configuration\n    let app = new App(workerName || 'worker', appOptions);\n\n    try {\n        await app.start_();\n    \n        if (initializer) {\n            await initializer(app);\n        }    \n        \n        const result = await worker(app);\n        \n        if (!dontStop) {\n            await app.stop_();\n        }\n\n        if (uninitializer) {\n            await uninitializer();\n        }\n\n        return result;\n    } catch (error) {\n        if (throwOnError) {\n            throw error;\n        }\n        \n        console.error(error.message || error);\n        process.exit(1);\n    } \n}\n\nmodule.exports = startWorker;"],"names":["startWorker","worker","options","workerName","dontStop","initializer","uninitializer","throwOnError","verbose","appOptions","logger","level","App","require","app","start_","result","stop_","error","console","message","process","exit","module","exports"],"mappings":"aAQA,eAAeA,YAAYC,MAAM,CAAEC,OAAO,CAAE,CACxC,KAAM,CAAEC,UAAU,CAAEC,QAAQ,CAAEC,WAAW,CAAEC,aAAa,CAAEC,YAAY,CAAEC,OAAO,CAAE,GAAGC,WAAY,CAAIP,SAAW,CAAC,EAEhH,GAAIM,QAAS,CACTC,WAAWC,MAAM,CAAG,CAChB,GAAGD,WAAWC,MAAM,CACpBC,MAAO,SACX,CACJ,CAAC,AAED,MAAMC,IAAMC,QAAQ,MAGpB,IAAIC,IAAM,IAAIF,IAAIT,YAAc,SAAUM,YAE1C,GAAI,CACA,MAAMK,IAAIC,MAAM,GAEhB,GAAIV,YAAa,CACb,MAAMA,YAAYS,IACtB,CAAC,AAED,MAAME,OAAS,MAAMf,OAAOa,KAE5B,GAAI,CAACV,SAAU,CACX,MAAMU,IAAIG,KAAK,EACnB,CAAC,AAED,GAAIX,cAAe,CACf,MAAMA,eACV,CAAC,AAED,OAAOU,MACX,CAAE,MAAOE,MAAO,CACZ,GAAIX,aAAc,CACd,MAAMW,KAAM,AAChB,CAAC,AAEDC,QAAQD,KAAK,CAACA,MAAME,OAAO,EAAIF,OAC/BG,QAAQC,IAAI,CAAC,EACjB,CACJ,CAEAC,OAAOC,OAAO,CAAGxB"}
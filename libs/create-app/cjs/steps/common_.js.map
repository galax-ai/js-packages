{"version":3,"sources":["../../src/steps/common_.js"],"sourcesContent":["import path from 'node:path';\nimport { _, eachAsync_ } from '@galaxar/utils';\nimport { fs } from '@galaxar/sys';\nimport updateFile_ from './updateFile_';\nimport * as packageManagers from './packageManager';\n\nmodule.exports = async (app, targetPath, initMeta, options) => {\n    const npmrcPath = path.join(targetPath, '.npmrc');\n    const npmrcExists = await fs.exists(npmrcPath);\n\n    const needUpdateNpmrc = options.registry !== 'npmjs' || npmrcExists;\n\n    if (needUpdateNpmrc) {\n        await updateFile_(app, targetPath, '.npmrc', (vars) => {\n            const { registry, ...otherVars } = vars;\n\n            if (options.registry !== 'npmjs') {\n                let _registry = options.registry;\n\n                return {\n                    ...otherVars,\n                    registry: _registry,\n                };\n            }\n\n            return otherVars;\n        });\n    }\n\n    // remove files of other package manager\n    const pm = options.packageManager;\n    const allOtherPms = Object.keys(_.omit(packageManagers, [pm]));\n\n    await eachAsync_(allOtherPms, async _pm => {\n        const files = initMeta[_pm]?.files;\n        if (files) {\n            await eachAsync_(files, async file => {\n                await fs.remove(path.join(targetPath, file));\n            });\n        }\n    });    \n\n    // remove init meta file\n    await fs.remove(path.join(targetPath, '.galaxar.init.js'));\n};\n"],"names":["module","exports","app","targetPath","initMeta","options","npmrcPath","path","join","npmrcExists","fs","exists","needUpdateNpmrc","registry","updateFile_","vars","otherVars","_registry","pm","packageManager","allOtherPms","Object","keys","_","omit","packageManagers","eachAsync_","_pm","files","file","remove"],"mappings":";;;;iEAAiB;uBACa;qBACX;oEACK;wEACS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEjCA,OAAOC,OAAO,GAAG,OAAOC,KAAKC,YAAYC,UAAUC,UAAY;IAC3D,MAAMC,YAAYC,iBAAI,CAACC,IAAI,CAACL,YAAY;IACxC,MAAMM,cAAc,MAAMC,OAAE,CAACC,MAAM,CAACL;IAEpC,MAAMM,kBAAkBP,QAAQQ,QAAQ,KAAK,WAAWJ;IAExD,IAAIG,iBAAiB;QACjB,MAAME,IAAAA,oBAAW,EAACZ,KAAKC,YAAY,UAAU,CAACY,OAAS;YACnD,MAAM,EAAEF,SAAQ,EAAE,GAAGG,WAAW,GAAGD;YAEnC,IAAIV,QAAQQ,QAAQ,KAAK,SAAS;gBAC9B,IAAII,YAAYZ,QAAQQ,QAAQ;gBAEhC,OAAO;oBACH,GAAGG,SAAS;oBACZH,UAAUI;gBACd;YACJ,CAAC;YAED,OAAOD;QACX;IACJ,CAAC;IAED,wCAAwC;IACxC,MAAME,KAAKb,QAAQc,cAAc;IACjC,MAAMC,cAAcC,OAAOC,IAAI,CAACC,QAAC,CAACC,IAAI,CAACC,iBAAiB;QAACP;KAAG;IAE5D,MAAMQ,IAAAA,iBAAU,EAACN,aAAa,OAAMO,MAAO;QACvC,MAAMC,QAAQxB,QAAQ,CAACuB,IAAI,EAAEC;QAC7B,IAAIA,OAAO;YACP,MAAMF,IAAAA,iBAAU,EAACE,OAAO,OAAMC,OAAQ;gBAClC,MAAMnB,OAAE,CAACoB,MAAM,CAACvB,iBAAI,CAACC,IAAI,CAACL,YAAY0B;YAC1C;QACJ,CAAC;IACL;IAEA,wBAAwB;IACxB,MAAMnB,OAAE,CAACoB,MAAM,CAACvB,iBAAI,CAACC,IAAI,CAACL,YAAY;AAC1C"}
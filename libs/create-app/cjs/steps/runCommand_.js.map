{"version":3,"sources":["../../src/steps/runCommand_.js"],"sourcesContent":["import { cmd } from \"@galaxar/sys\";\nimport { _ } from \"@galaxar/utils\";\n\nmodule.exports = async (app, workingPath, command, treatErrorAsInfo) => {\n    const lastWd = process.cwd();\n    let cwdChanged = false;\n\n    if (workingPath !== lastWd) {\n        process.chdir(workingPath);\n        cwdChanged = true;\n    }   \n\n    app.log('info', command);       \n\n    try {\n        const [ program, ...args ] = command.split(' ');\n\n        await cmd.runLive_(program, args, data => {\n            let output = data.toString();\n            \n            if (output.endsWith('\\r\\n')) {\n                output = output.slice(0, -2);\n            } else if (output.endsWith('\\n')) {\n                output = output.slice(0, -1);\n            }\n\n            if (_.trimStart(output).substring(0, 4).toLocaleLowerCase() === 'warn') {\n                app.log('warn', output);\n            } else {\n                app.log('info', output);\n            }            \n        }, data => {\n            if (treatErrorAsInfo) {\n                app.log('info', data.toString());\n            } else {\n                app.log('error', data.toString());\n            }            \n        });\n    } finally {\n        if (cwdChanged) {\n            process.chdir(lastWd);    \n        }        \n    }       \n}"],"names":["module","exports","app","workingPath","command","treatErrorAsInfo","lastWd","process","cwd","cwdChanged","chdir","log","program","args","split","cmd","runLive_","data","output","toString","endsWith","slice","_","trimStart","substring","toLocaleLowerCase"],"mappings":";;;;qBAAoB;uBACF;AAElBA,OAAOC,OAAO,GAAG,OAAOC,KAAKC,aAAaC,SAASC,mBAAqB;IACpE,MAAMC,SAASC,QAAQC,GAAG;IAC1B,IAAIC,aAAa,KAAK;IAEtB,IAAIN,gBAAgBG,QAAQ;QACxBC,QAAQG,KAAK,CAACP;QACdM,aAAa,IAAI;IACrB,CAAC;IAEDP,IAAIS,GAAG,CAAC,QAAQP;IAEhB,IAAI;QACA,MAAM,CAAEQ,SAAS,GAAGC,KAAM,GAAGT,QAAQU,KAAK,CAAC;QAE3C,MAAMC,QAAG,CAACC,QAAQ,CAACJ,SAASC,MAAMI,CAAAA,OAAQ;YACtC,IAAIC,SAASD,KAAKE,QAAQ;YAE1B,IAAID,OAAOE,QAAQ,CAAC,SAAS;gBACzBF,SAASA,OAAOG,KAAK,CAAC,GAAG,CAAC;YAC9B,OAAO,IAAIH,OAAOE,QAAQ,CAAC,OAAO;gBAC9BF,SAASA,OAAOG,KAAK,CAAC,GAAG,CAAC;YAC9B,CAAC;YAED,IAAIC,QAAC,CAACC,SAAS,CAACL,QAAQM,SAAS,CAAC,GAAG,GAAGC,iBAAiB,OAAO,QAAQ;gBACpEvB,IAAIS,GAAG,CAAC,QAAQO;YACpB,OAAO;gBACHhB,IAAIS,GAAG,CAAC,QAAQO;YACpB,CAAC;QACL,GAAGD,CAAAA,OAAQ;YACP,IAAIZ,kBAAkB;gBAClBH,IAAIS,GAAG,CAAC,QAAQM,KAAKE,QAAQ;YACjC,OAAO;gBACHjB,IAAIS,GAAG,CAAC,SAASM,KAAKE,QAAQ;YAClC,CAAC;QACL;IACJ,SAAU;QACN,IAAIV,YAAY;YACZF,QAAQG,KAAK,CAACJ;QAClB,CAAC;IACL;AACJ"}
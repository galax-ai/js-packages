{"version":3,"sources":["../../src/steps/runCommand_.js"],"sourcesContent":["const { cmd } = require(\"@genx/sys\");\nconst { _ } = require(\"@genx/july\");\n\nmodule.exports = async (app, workingPath, command, treatErrorAsInfo) => {\n    const lastWd = process.cwd();\n    let cwdChanged = false;\n\n    if (workingPath !== lastWd) {\n        process.chdir(workingPath);\n        cwdChanged = true;\n    }   \n\n    app.log('info', command);       \n\n    try {\n        const [ program, ...args ] = command.split(' ');\n\n        await cmd.runLive_(program, args, data => {\n            let output = data.toString();\n            \n            if (output.endsWith('\\r\\n')) {\n                output = output.slice(0, -2);\n            } else if (output.endsWith('\\n')) {\n                output = output.slice(0, -1);\n            }\n\n            if (_.trimStart(output).substring(0, 4).toLocaleLowerCase() === 'warn') {\n                app.log('warn', output);\n            } else {\n                app.log('info', output);\n            }            \n        }, data => {\n            if (treatErrorAsInfo) {\n                app.log('info', data.toString());\n            } else {\n                app.log('error', data.toString());\n            }            \n        });\n    } finally {\n        if (cwdChanged) {\n            process.chdir(lastWd);    \n        }        \n    }       \n}"],"names":["cmd","require","_","module","exports","app","workingPath","command","treatErrorAsInfo","lastWd","process","cwd","cwdChanged","chdir","log","program","args","split","runLive_","data","output","toString","endsWith","slice","trimStart","substring","toLocaleLowerCase"],"mappings":";AAAA,MAAM,EAAEA,IAAG,EAAE,GAAGC,QAAQ;AACxB,MAAM,EAAEC,EAAC,EAAE,GAAGD,QAAQ;AAEtBE,OAAOC,OAAO,GAAG,OAAOC,KAAKC,aAAaC,SAASC,mBAAqB;IACpE,MAAMC,SAASC,QAAQC,GAAG;IAC1B,IAAIC,aAAa,KAAK;IAEtB,IAAIN,gBAAgBG,QAAQ;QACxBC,QAAQG,KAAK,CAACP;QACdM,aAAa,IAAI;IACrB,CAAC;IAEDP,IAAIS,GAAG,CAAC,QAAQP;IAEhB,IAAI;QACA,MAAM,CAAEQ,SAAS,GAAGC,KAAM,GAAGT,QAAQU,KAAK,CAAC;QAE3C,MAAMjB,IAAIkB,QAAQ,CAACH,SAASC,MAAMG,CAAAA,OAAQ;YACtC,IAAIC,SAASD,KAAKE,QAAQ;YAE1B,IAAID,OAAOE,QAAQ,CAAC,SAAS;gBACzBF,SAASA,OAAOG,KAAK,CAAC,GAAG,CAAC;YAC9B,OAAO,IAAIH,OAAOE,QAAQ,CAAC,OAAO;gBAC9BF,SAASA,OAAOG,KAAK,CAAC,GAAG,CAAC;YAC9B,CAAC;YAED,IAAIrB,EAAEsB,SAAS,CAACJ,QAAQK,SAAS,CAAC,GAAG,GAAGC,iBAAiB,OAAO,QAAQ;gBACpErB,IAAIS,GAAG,CAAC,QAAQM;YACpB,OAAO;gBACHf,IAAIS,GAAG,CAAC,QAAQM;YACpB,CAAC;QACL,GAAGD,CAAAA,OAAQ;YACP,IAAIX,kBAAkB;gBAClBH,IAAIS,GAAG,CAAC,QAAQK,KAAKE,QAAQ;YACjC,OAAO;gBACHhB,IAAIS,GAAG,CAAC,SAASK,KAAKE,QAAQ;YAClC,CAAC;QACL;IACJ,SAAU;QACN,IAAIT,YAAY;YACZF,QAAQG,KAAK,CAACJ;QAClB,CAAC;IACL;AACJ"}